<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Marinelife Record</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="title">
        <h1>ğŸ My Marinelife RecordğŸ¡</h1>
    </div>

    <div class="input_area">
        <h1>æµ·æ´‹ç”Ÿç‰©ã®ãƒ­ã‚°ä»˜ã‘</h1>
        <div class="date">
            <label>ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ã—ãŸæ—¥</label>
            <input type="date" id="date">
        </div>

        <div class="name">
            <label>å‡ºä¼šã£ãŸæµ·æ´‹ç”Ÿç‰©ã®åå‰</label>
            <input type="text" id="name">
        </div>

        <div class="local">
            <label>ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ãƒã‚¤ãƒ³ãƒˆ</label>
            <input type="text" id="local">
        </div>

        <div class="memo">
            <label>ã©ã‚“ãªè‰²ã‚„å½¢ï¼Ÿã©ã“ã«ã„ãŸï¼Ÿãªã©ğŸ“</label>
            <input type="text" id="memo">
        </div>

        <div class="photo">
            <label>å†™çœŸ</label>
            <input type="file" id="photo">
            <img id="preview" alt="ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" style="display: none; max-width: 200px;">
        </div>

        <button id="save">ãƒ­ã‚°è¨˜éŒ²ã‚’ä¿å­˜</button>
    </div>

    <div class="calendar_area">
        <h1>æµ·æ´‹ç”Ÿç‰©ã®è¨˜éŒ²ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1>
        <div id="calendar"></div>
        <button id="clearAll">å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
    </div>

    <div class="display_area">
        <h1>å‡ºä¼šã£ãŸæµ·æ´‹ç”Ÿç‰©é”</h1>
        <div id="output"></div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
      $(document).ready(function () {
     // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ä»¥ä¸‹ã®é–¢æ•°ã‚’å®Ÿè¡Œã—ã¾ã™ã‚ˆ
            
            generateCalendar();
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é–¢æ•°ã‚’ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å‘¼ã³å‡ºã—ã¾ã™

            $('#photo').on('change', function () { 
            // photo id ã®ç”»åƒã‚’é¸æŠã—ãŸã‚‰ãƒã‚§ãƒ³ã‚¸ãŒèµ·ã“ã‚‹
                const file = this.files[0];
                // é¸æŠã•ã‚ŒãŸæœ€åˆã®ç”»åƒã‚’ï¼ˆ0ï¼‰fileã¨ã„ã†ç®±ã«å…¥ã‚ŒãŸ
                if (file) {
                // fileï¼ˆæœ€åˆã®ç”»åƒï¼‰ãŒé¸æŠã•ã‚Œã¦ã„ãŸã‚‰ä»¥ä¸‹ã®å‡¦ç†ãŒå®Ÿè¡Œ
                    const reader = new FileReader();
                    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Œã‚‹å½¢ã«å¤‰ãˆã‚‹
                    reader.onload = function (e) {
                        $('#preview').attr('src', e.target.result).show();
                    };
                    // èª­ã¿è¾¼ã‚“ã ç”»åƒã‚’è¡¨ç¤º
                    reader.readAsDataURL(file);
                    // ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹
                }
            });
            // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ãŸã‚‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹å‡¦ç†

            $('#save').on('click', function () {
            // save ãƒœã‚¿ãƒ³æŠ¼ã—ãŸã‚‰ä»¥ä¸‹ã‚’å®Ÿè¡Œ
                const fishdata = {
                    date: $('#date').val(),
                    name: $('#name').val(),
                    local: $('#local').val(),
                    memo: $('#memo').val(),
                    photo: $('#preview').attr('src')
                    // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆ#previewï¼‰ã®srcï¼ˆç”»åƒã®URLï¼‰ã‚’å–ã‚Šå‡ºã—ã¦ã€photoã¨ã—ã¦ä¿å­˜
                };

                let fishRecords = JSON.parse(localStorage.getItem('fishRecords')) || [];
                //    ï¼Ÿ
                fishRecords.push(fishdata);
                // fishRecordsã«æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹
                localStorage.setItem('fishRecords', JSON.stringify(fishRecords));
                // fishRecordsã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã«å¤‰æ›ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«è¿½åŠ 


                alert("ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ");
                $('#date, #name, #local, #memo').val('');
                $('#photo').val('');
                $('#preview').attr('src', '').hide();

                generateCalendar();
            });

            $('#clearAll').on('click', function () {
                if (confirm("ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
                    localStorage.removeItem('fishRecords');
                    alert("ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ");
                    generateCalendar();
                    $('#output').html('');
                }
            });

            function generateCalendar(year = new Date().getFullYear(), month = new Date().getMonth()) {
                const fishRecords = JSON.parse(localStorage.getItem('fishRecords')) || [];
                const recordDates = fishRecords.map(record => record.date);
                $('#calendar').html('');

                $('#calendar').append(`
            <div class="calendar_header">
                <button id="prevMonth">â—€</button>
                <span id="calendarTitle">${year}å¹´${month + 1}æœˆ</span>
                <button id="nextMonth">â–¶</button>
            </div>
        `);

                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                let day = 1;
                let calendarHTML = '';

                for (let week = 0; day <= daysInMonth; week++) {
                    calendarHTML += `<div class="calendar_row">`;

                    for (let weekday = 0; weekday < 7; weekday++) {
                        if (week === 0 && weekday < firstDay) {
                            calendarHTML += `<div class="calendar_day empty"></div>`;
                        } else if (day <= daysInMonth) {
                            const dayString = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                            const isRecorded = recordDates.includes(dayString);

                            calendarHTML += `
                        <div class="calendar_day">
                            ${day}
                            ${isRecorded ? `<span class="fish_icon" data-date="${dayString}">ğŸŸ</span>` : ''}
                        </div>
                    `;
                            day++;
                        } else {
                            calendarHTML += `<div class="calendar_day empty"></div>`;
                        }
                    }

                    calendarHTML += `</div>`;
                }

                $('#calendar').append(calendarHTML);

                // é­šã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã§ãã®æ—¥ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                $('.fish_icon').on('click', function () {
                    const selectedDate = $(this).data('date');
                    displayData(selectedDate);
                });

                // æœˆå¤‰æ›´ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
                $('#prevMonth').on('click', function () {
                    const newMonth = month === 0 ? 11 : month - 1;
                    const newYear = month === 0 ? year - 1 : year;
                    generateCalendar(newYear, newMonth);
                });

                $('#nextMonth').on('click', function () {
                    const newMonth = month === 11 ? 0 : month + 1;
                    const newYear = month === 11 ? year + 1 : year;
                    generateCalendar(newYear, newMonth);
                });
            }

            function displayData(date) {
                const fishRecords = JSON.parse(localStorage.getItem('fishRecords')) || [];
                const selectedRecords = fishRecords.filter(record => record.date === date);
                $('#output').html('');

                selectedRecords.forEach((data, index) => {
                    $('#output').append(`
                <div class="record">
                    <p>${data.date}ã« ${data.name} ã¨ ${data.local}ã§ä¼šã£ãŸï¼</p>
                    <p>ãƒ¡ãƒ¢ï¼š${data.memo}</p>
                    <img src="${data.photo}" alt="ä¿å­˜ã—ãŸç”»åƒ" style="max-width: 200px;">
                    <button class="deleteButton" data-index="${index}" data-date="${date}">å‰Šé™¤</button>
                </div>
            `);
                });

                // å„å‰Šé™¤ãƒœã‚¿ãƒ³ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
                $('.deleteButton').on('click', function () {
                    const indexToDelete = $(this).data('index');
                    const dateToDelete = $(this).data('date');
                    deleteRecord(dateToDelete, indexToDelete);
                });
            }

            function deleteRecord(date, index) {
              let fishRecords = JSON.parse(localStorage.getItem('fishRecords')) || [];

              // æŒ‡å®šã®æ—¥ä»˜ã®ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å†è¨ˆç®—ã—ã€æ­£ç¢ºã«å‰Šé™¤
              const actualIndex = fishRecords.findIndex((record, i) => record.date === date && fishRecords.filter(r => r.date === date).indexOf(record) === index);

              if (actualIndex !== -1) {
                  fishRecords.splice(actualIndex, 1); // æŒ‡å®šã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§å‰Šé™¤
                  localStorage.setItem('fishRecords', JSON.stringify(fishRecords));
                  alert("ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ");

                  displayData(date); // ç¾åœ¨ã®è¡¨ç¤ºã‚’æ›´æ–°
                  generateCalendar(); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æ›´æ–°
              } else {
                  console.error("å‰Šé™¤å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
              }
          }
          
        });

    </script>

</body>

</html>